{"version":3,"sources":["components/layout/Heading/index.tsx","components/layout/Heading/index.module.scss","logic/contracts/api/masterCopies.ts","routes/safe/components/Settings/SafeDetails/style.ts","routes/safe/components/Settings/UpdateSafeModal/style.ts","logic/safe/utils/upgradeSafe.ts","routes/safe/components/Settings/UpdateSafeModal/index.tsx","routes/safe/components/Settings/SafeDetails/index.tsx"],"names":["cx","classNames","bind","styles","Heading","props","align","children","className","color","margin","tag","testId","truncate","rest","classes","capitalize","undefined","React","module","exports","MasterCopyDeployer","createStyles","formContainer","padding","lg","root","display","maxWidth","saveBtn","fontWeight","boldFont","marginRight","sm","controlsRow","borderTop","border","bottom","boxSizing","position","width","useStyles","makeStyles","heading","justifyContent","height","headingText","fontSize","close","modalContent","md","gasCostsContainer","backgroundColor","background","getUpgradeSafeTransactionHash","safeAddress","safeCurrentVersion","safeMasterContractAddress","getSafeMasterContractAddress","txs","to","value","data","getGnosisSafeInstanceAt","methods","changeMasterCopy","encodeABI","hasSetFallbackHandler","semverSatisfies","LATEST_SAFE_VERSION","fallbackHandlerAddress","getFallbackHandlerContractAddress","safeInstance","setFallbackHandler","EMPTY_DATA","getFallbackHandlerTxData","encodeMultiSendCall","UpdateSafeModal","onClose","dispatch","useDispatch","useState","multiSendCallData","setMultiSendCallData","useEstimateTransactionGas","txRecipient","getMultisendContractAddress","txData","txAmount","operation","DELEGATE_CALL","gasCostFormatted","txEstimationExecutionStatus","isExecution","isCreation","isOffChainSignature","gasPriceFormatted","gasLimit","gasEstimation","useEstimationStatus","buttonStatus","useEffect","encodeMultiSendCallData","confirmButtonText","ButtonStatus","LOADING","EstimationStatus","EditableTxParameters","ethGasLimit","ethGasPrice","safeTxGas","toString","txParameters","toggleEditMode","Row","grow","Paragraph","noMargin","weight","IconButton","disableRipple","onClick","Hairline","Block","Link","target","TxParametersDetail","onEdit","compact","isTransactionCreation","isTransactionExecution","Modal","Footer","withoutBorder","Buttons","cancelButtonProps","text","confirmButtonProps","createTransaction","valueInWei","txNonce","safeNonce","Number","ethParameters","notifiedTransaction","handleSubmit","status","extractMasterCopyInfo","mc","isCircles","version","toLowerCase","includes","CIRCLES","dashIndex","indexOf","address","substring","deployer","GNOSIS","deployerRepoUrl","fetchMasterCopies","memoize","a","url","getTxServiceUrl","axios","get","res","map","console","error","SAFE_NAME_INPUT_TEST_ID","SAFE_NAME_SUBMIT_BTN_TEST_ID","SAFE_NAME_UPDATE_SAFE_BTN_TEST_ID","StyledLink","styled","StyledIcon","Icon","SafeDetails","isUserOwner","useSelector","grantedSelector","latestMasterContractVersion","latestMasterContractVersionSelector","currentSafeWithNames","safeName","name","safeNeedsUpdate","needsUpdate","currentVersion","trackEvent","useAnalytics","isModalOpen","setModalOpen","safeInfo","setSafeInfo","toggleModal","prevOpen","handleUpdateSafe","category","SAFE_NAVIGATION_EVENT","action","label","masterCopies","getMasterCopyAddressFromProxyAddress","masterCopyAddress","masterCopy","find","sameAddress","getMasterCopyInfo","GnoForm","onSubmit","values","addressBookAddOrUpdate","makeAddressBookEntry","updateSafe","loadedViaUrl","notification","getNotificationsFromTxType","TX_NOTIFICATION_TYPES","SAFE_NAME_CHANGE_TX","enqueueSnackbar","enhanceSnackbarForAction","afterExecution","noMoreConfirmationsNeeded","rel","href","size","as","type","Button","variant","Field","component","TextField","defaultValue","placeholder","validate","composeValidators","required","validAddressBookName","Col","end","description","handleClose","open","title"],"mappings":"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","file":"static/js/64.2573d954.chunk.js","sourcesContent":["import classNames from 'classnames/bind'\nimport * as React from 'react'\n\nimport styles from './index.module.scss'\n\nimport { capitalize } from 'src/utils/css'\n\nconst cx = classNames.bind(styles)\n\nconst Heading = (props) => {\n  const { align, children, className = '', color, margin, tag, testId, truncate, ...rest } = props\n\n  const classes = cx(className, 'heading', align, tag, margin ? capitalize(margin, 'margin') : undefined, color, {\n    truncate,\n  })\n\n  return React.createElement(tag, { ...rest, className: classes, 'data-testid': testId || '' }, children)\n}\n\nexport default Heading\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"heading\":\"Heading_heading__3Wz9P\",\"h1\":\"Heading_h1__MXfCA\",\"h2\":\"Heading_h2__3X6Ts\",\"h3\":\"Heading_h3__1k2fD\",\"h4\":\"Heading_h4__1YCmR\",\"center\":\"Heading_center__28MHY\",\"right\":\"Heading_right__1fQM1\",\"truncate\":\"Heading_truncate__2Lq93\",\"marginSm\":\"Heading_marginSm__13YwX\",\"marginMd\":\"Heading_marginMd__2AnZN\",\"marginLg\":\"Heading_marginLg__2ZfEq\",\"marginXl\":\"Heading_marginXl__3RHt7\",\"soft\":\"Heading_soft__2Zu43\",\"medium\":\"Heading_medium__2X8Z-\",\"dark\":\"Heading_dark__Ds2QB\",\"fancy\":\"Heading_fancy__1Wx6l\",\"warning\":\"Heading_warning__2lrZC\",\"primary\":\"Heading_primary__2hOk2\",\"secondary\":\"Heading_secondary__37lKs\",\"disabled\":\"Heading_disabled__30DjG\",\"error\":\"Heading_error__t5ujr\",\"white\":\"Heading_white__2gkIK\"};","import axios from 'axios'\nimport { getTxServiceUrl } from 'src/config'\nimport memoize from 'lodash.memoize'\n\nexport enum MasterCopyDeployer {\n  GNOSIS = 'Gnosis',\n  CIRCLES = 'Circles',\n}\n\ntype MasterCopyFetch = {\n  address: string\n  version: string\n}\n\nexport type MasterCopy = {\n  address: string\n  version: string\n  deployer: MasterCopyDeployer\n  deployerRepoUrl: string\n}\n\nconst extractMasterCopyInfo = (mc: MasterCopyFetch): MasterCopy => {\n  const isCircles = mc.version.toLowerCase().includes(MasterCopyDeployer.CIRCLES.toLowerCase())\n  const dashIndex = mc.version.indexOf('-')\n\n  const masterCopy = {\n    address: mc.address,\n    version: !isCircles ? mc.version : mc.version.substring(0, dashIndex),\n    deployer: !isCircles ? MasterCopyDeployer.GNOSIS : MasterCopyDeployer.CIRCLES,\n    deployerRepoUrl: !isCircles\n      ? 'https://github.com/gnosis/safe-contracts/releases'\n      : 'https://github.com/CirclesUBI/safe-contracts/releases',\n  }\n  return masterCopy\n}\n\nexport const fetchMasterCopies = memoize(\n  async (): Promise<MasterCopy[] | undefined> => {\n    const url = `${getTxServiceUrl()}/about/master-copies/`\n    try {\n      const res = await axios.get<{ address: string; version: string }[]>(url)\n      return res.data.map(extractMasterCopyInfo)\n    } catch (error) {\n      console.error('Fetching data from master-copies errored', error)\n    }\n  },\n)\n","import { createStyles } from '@material-ui/core/styles'\nimport { boldFont, border, lg, sm } from 'src/theme/variables'\n\nexport const styles = createStyles({\n  formContainer: {\n    padding: lg,\n  },\n  root: {\n    display: 'flex',\n    maxWidth: '460px',\n  },\n  saveBtn: {\n    fontWeight: boldFont,\n    marginRight: sm,\n  },\n  controlsRow: {\n    borderTop: `2px solid ${border}`,\n    bottom: 0,\n    boxSizing: 'border-box',\n    padding: lg,\n    position: 'absolute',\n    width: '100%',\n  },\n})\n","import { background, lg, md, sm } from 'src/theme/variables'\nimport { createStyles, makeStyles } from '@material-ui/core'\n\nexport const useStyles = makeStyles(\n  createStyles({\n    heading: {\n      padding: `${sm} ${lg}`,\n      justifyContent: 'space-between',\n      boxSizing: 'border-box',\n      height: '74px',\n    },\n    headingText: {\n      fontSize: lg,\n    },\n    close: {\n      height: '35px',\n      width: '35px',\n    },\n    modalContent: {\n      padding: `${md} ${lg}`,\n    },\n    gasCostsContainer: {\n      backgroundColor: background,\n      padding: `0 ${lg}`,\n    },\n  }),\n)\n","import semverSatisfies from 'semver/functions/satisfies'\n\nimport { LATEST_SAFE_VERSION } from 'src/utils/constants'\nimport {\n  getGnosisSafeInstanceAt,\n  getSafeMasterContractAddress,\n  getFallbackHandlerContractAddress,\n} from 'src/logic/contracts/safeContracts'\nimport { encodeMultiSendCall } from 'src/logic/safe/transactions/multisend'\nimport { EMPTY_DATA } from 'src/logic/wallets/ethTransactions'\n\nconst getFallbackHandlerTxData = (safeAddress: string): string => {\n  const hasSetFallbackHandler = semverSatisfies(LATEST_SAFE_VERSION, '>=1.1.0')\n\n  const fallbackHandlerAddress = getFallbackHandlerContractAddress()\n  const safeInstance = getGnosisSafeInstanceAt(safeAddress, LATEST_SAFE_VERSION)\n\n  return hasSetFallbackHandler\n    ? safeInstance.methods.setFallbackHandler(fallbackHandlerAddress).encodeABI()\n    : EMPTY_DATA\n}\n\nexport const getUpgradeSafeTransactionHash = (safeAddress: string, safeCurrentVersion: string): string => {\n  const safeMasterContractAddress = getSafeMasterContractAddress()\n  const safeInstance = getGnosisSafeInstanceAt(safeAddress, safeCurrentVersion)\n  const updateSafeTxData = safeInstance.methods.changeMasterCopy(safeMasterContractAddress).encodeABI()\n  const fallbackHandlerTxData = getFallbackHandlerTxData(safeAddress)\n  const txs = [\n    {\n      to: safeAddress,\n      value: '0',\n      data: updateSafeTxData,\n    },\n    {\n      to: safeAddress,\n      value: '0',\n      data: fallbackHandlerTxData,\n    },\n  ]\n\n  return encodeMultiSendCall(txs)\n}\n","import IconButton from '@material-ui/core/IconButton'\nimport Close from '@material-ui/icons/Close'\nimport React, { useEffect, useState } from 'react'\nimport { useDispatch } from 'react-redux'\n\nimport { useStyles } from './style'\n\nimport { LATEST_SAFE_VERSION } from 'src/utils/constants'\nimport Link from 'src/components/layout/Link'\nimport Block from 'src/components/layout/Block'\nimport Hairline from 'src/components/layout/Hairline'\nimport Paragraph from 'src/components/layout/Paragraph'\nimport Row from 'src/components/layout/Row'\nimport { getUpgradeSafeTransactionHash } from 'src/logic/safe/utils/upgradeSafe'\nimport { createTransaction } from 'src/logic/safe/store/actions/createTransaction'\nimport { ButtonStatus, Modal } from 'src/components/Modal'\nimport { TransactionFees } from 'src/components/TransactionsFees'\nimport { EstimationStatus, useEstimateTransactionGas } from 'src/logic/hooks/useEstimateTransactionGas'\nimport { useEstimationStatus } from 'src/logic/hooks/useEstimationStatus'\nimport { getMultisendContractAddress } from 'src/logic/contracts/safeContracts'\nimport { DELEGATE_CALL } from 'src/logic/safe/transactions'\nimport { EMPTY_DATA } from 'src/logic/wallets/ethTransactions'\nimport { TxParametersDetail } from 'src/routes/safe/components/Transactions/helpers/TxParametersDetail'\nimport { EditableTxParameters } from 'src/routes/safe/components/Transactions/helpers/EditableTxParameters'\nimport { TxParameters } from 'src/routes/safe/container/hooks/useTransactionParameters'\n\ntype Props = {\n  onClose: () => void\n  safeAddress: string\n  safeCurrentVersion: string\n}\n\nexport const UpdateSafeModal = ({ onClose, safeAddress, safeCurrentVersion }: Props): React.ReactElement => {\n  const classes = useStyles()\n  const dispatch = useDispatch()\n  const [multiSendCallData, setMultiSendCallData] = useState(EMPTY_DATA)\n\n  const {\n    gasCostFormatted,\n    txEstimationExecutionStatus,\n    isExecution,\n    isCreation,\n    isOffChainSignature,\n    gasPriceFormatted,\n    gasLimit,\n    gasEstimation,\n  } = useEstimateTransactionGas({\n    txRecipient: getMultisendContractAddress(),\n    txData: multiSendCallData,\n    txAmount: '0',\n    operation: DELEGATE_CALL,\n  })\n\n  const [buttonStatus] = useEstimationStatus(txEstimationExecutionStatus)\n\n  useEffect(() => {\n    const encodeMultiSendCallData = getUpgradeSafeTransactionHash(safeAddress, safeCurrentVersion)\n    setMultiSendCallData(encodeMultiSendCallData)\n  }, [safeAddress, safeCurrentVersion])\n\n  const handleSubmit = (txParameters: TxParameters) => {\n    // Call the update safe method\n    dispatch(\n      createTransaction({\n        safeAddress,\n        to: getMultisendContractAddress(),\n        valueInWei: '0',\n        txData: multiSendCallData,\n        txNonce: txParameters.safeNonce,\n        safeTxGas: txParameters.safeTxGas ? Number(txParameters.safeTxGas) : undefined,\n        ethParameters: txParameters,\n        notifiedTransaction: 'STANDARD_TX',\n        operation: DELEGATE_CALL,\n      }),\n    )\n    onClose()\n  }\n\n  let confirmButtonText = 'Update Safe'\n  if (ButtonStatus.LOADING === buttonStatus) {\n    confirmButtonText = txEstimationExecutionStatus === EstimationStatus.LOADING ? 'Estimating' : 'Updating'\n  }\n\n  return (\n    <EditableTxParameters\n      isOffChainSignature={isOffChainSignature}\n      isExecution={isExecution}\n      ethGasLimit={gasLimit}\n      ethGasPrice={gasPriceFormatted}\n      safeTxGas={gasEstimation.toString()}\n    >\n      {(txParameters, toggleEditMode) => (\n        <>\n          <Row align=\"center\" className={classes.heading} grow>\n            <Paragraph className={classes.headingText} noMargin weight=\"bolder\">\n              Update to new Safe version\n            </Paragraph>\n            <IconButton disableRipple onClick={onClose}>\n              <Close className={classes.close} />\n            </IconButton>\n          </Row>\n          <Hairline />\n          <Block className={classes.modalContent}>\n            <Row>\n              <Paragraph>\n                Update now to take advantage of new features and the highest security standards available.\n              </Paragraph>\n              <Block>\n                To check details about updates added by this smart contract version please visit{' '}\n                <Link\n                  target=\"_blank\"\n                  to={`https://github.com/gnosis/safe-contracts/releases/tag/v${LATEST_SAFE_VERSION}`}\n                >\n                  latest Gnosis Safe contracts changelog\n                </Link>\n              </Block>\n              <Paragraph>\n                You will need to confirm this update just like any other transaction. This means other owners will have\n                to confirm the update in case more than one confirmation is required for this Safe.\n              </Paragraph>\n            </Row>\n            {/* Tx Parameters */}\n            <TxParametersDetail\n              txParameters={txParameters}\n              onEdit={toggleEditMode}\n              compact={false}\n              isTransactionCreation={isCreation}\n              isTransactionExecution={isExecution}\n              isOffChainSignature={isOffChainSignature}\n            />\n          </Block>\n          {txEstimationExecutionStatus === EstimationStatus.LOADING ? null : (\n            <Block className={classes.gasCostsContainer}>\n              <TransactionFees\n                gasCostFormatted={gasCostFormatted}\n                isExecution={isExecution}\n                isCreation={isCreation}\n                isOffChainSignature={isOffChainSignature}\n                txEstimationExecutionStatus={txEstimationExecutionStatus}\n              />\n            </Block>\n          )}\n          {/* Footer */}\n          <Modal.Footer withoutBorder={buttonStatus !== ButtonStatus.LOADING}>\n            <Modal.Footer.Buttons\n              cancelButtonProps={{\n                onClick: onClose,\n                text: 'Cancel',\n              }}\n              confirmButtonProps={{\n                onClick: () => handleSubmit(txParameters),\n                status: buttonStatus,\n                text: confirmButtonText,\n              }}\n            />\n          </Modal.Footer>\n        </>\n      )}\n    </EditableTxParameters>\n  )\n}\n","import { Icon, Link, Text } from '@gnosis.pm/safe-react-components'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, { ReactElement, useEffect, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled from 'styled-components'\n\nimport { styles } from './style'\n\nimport Modal from 'src/components/Modal'\nimport Field from 'src/components/forms/Field'\nimport GnoForm from 'src/components/forms/GnoForm'\nimport TextField from 'src/components/forms/TextField'\nimport { composeValidators, required, validAddressBookName } from 'src/components/forms/validator'\nimport Block from 'src/components/layout/Block'\nimport Button from 'src/components/layout/Button'\nimport Col from 'src/components/layout/Col'\nimport Heading from 'src/components/layout/Heading'\nimport Paragraph from 'src/components/layout/Paragraph'\nimport Row from 'src/components/layout/Row'\nimport { makeAddressBookEntry } from 'src/logic/addressBook/model/addressBook'\nimport { addressBookAddOrUpdate } from 'src/logic/addressBook/store/actions'\nimport enqueueSnackbar from 'src/logic/notifications/store/actions/enqueueSnackbar'\nimport { getNotificationsFromTxType, enhanceSnackbarForAction } from 'src/logic/notifications'\nimport { sameAddress } from 'src/logic/wallets/ethAddresses'\nimport { TX_NOTIFICATION_TYPES } from 'src/logic/safe/transactions'\nimport { UpdateSafeModal } from 'src/routes/safe/components/Settings/UpdateSafeModal'\nimport { grantedSelector } from 'src/routes/safe/container/selector'\nimport { updateSafe } from 'src/logic/safe/store/actions/updateSafe'\n\nimport {\n  currentSafeWithNames,\n  latestMasterContractVersion as latestMasterContractVersionSelector,\n} from 'src/logic/safe/store/selectors'\nimport { useAnalytics, SAFE_NAVIGATION_EVENT } from 'src/utils/googleAnalytics'\nimport { fetchMasterCopies, MasterCopy, MasterCopyDeployer } from 'src/logic/contracts/api/masterCopies'\nimport { getMasterCopyAddressFromProxyAddress } from 'src/logic/contracts/safeContracts'\n\nexport const SAFE_NAME_INPUT_TEST_ID = 'safe-name-input'\nexport const SAFE_NAME_SUBMIT_BTN_TEST_ID = 'change-safe-name-btn'\nexport const SAFE_NAME_UPDATE_SAFE_BTN_TEST_ID = 'update-safe-name-btn'\n\nconst useStyles = makeStyles(styles)\n\nconst StyledLink = styled(Link)`\n  margin: 12px 0 0 0;\n`\nconst StyledIcon = styled(Icon)`\n  position: relative;\n  top: 3px;\n  left: 6px;\n`\n\nconst SafeDetails = (): ReactElement => {\n  const classes = useStyles()\n  const isUserOwner = useSelector(grantedSelector)\n  const latestMasterContractVersion = useSelector(latestMasterContractVersionSelector)\n  const {\n    address: safeAddress,\n    name: safeName,\n    needsUpdate: safeNeedsUpdate,\n    currentVersion: safeCurrentVersion,\n  } = useSelector(currentSafeWithNames)\n  const dispatch = useDispatch()\n  const { trackEvent } = useAnalytics()\n\n  const [isModalOpen, setModalOpen] = useState(false)\n  const [safeInfo, setSafeInfo] = useState<MasterCopy | undefined>()\n\n  const toggleModal = () => {\n    setModalOpen((prevOpen) => !prevOpen)\n  }\n\n  const handleSubmit = (values) => {\n    dispatch(addressBookAddOrUpdate(makeAddressBookEntry({ address: safeAddress, name: values.safeName })))\n    // setting `loadedViaUrl` to `false` as setting a safe's name is considered to intentionally add the safe\n    dispatch(updateSafe({ address: safeAddress, loadedViaUrl: false }))\n\n    const notification = getNotificationsFromTxType(TX_NOTIFICATION_TYPES.SAFE_NAME_CHANGE_TX)\n    dispatch(enqueueSnackbar(enhanceSnackbarForAction(notification.afterExecution.noMoreConfirmationsNeeded)))\n  }\n\n  const handleUpdateSafe = () => {\n    setModalOpen(true)\n  }\n\n  const getSafeVersion = () => {\n    if (!safeInfo) {\n      return ''\n    }\n    return safeInfo.deployer === MasterCopyDeployer.GNOSIS\n      ? safeCurrentVersion\n      : `${safeCurrentVersion}-${safeInfo.deployer}`\n  }\n\n  const getSafeVersionUpdate = () => {\n    if (!safeInfo) {\n      return ''\n    }\n    return safeInfo.deployer === MasterCopyDeployer.GNOSIS && safeNeedsUpdate\n      ? ` (there's a newer version: ${latestMasterContractVersion})`\n      : ''\n  }\n\n  useEffect(() => {\n    trackEvent({ category: SAFE_NAVIGATION_EVENT, action: 'Settings', label: 'Details' })\n  }, [trackEvent])\n\n  useEffect(() => {\n    const getMasterCopyInfo = async () => {\n      const masterCopies = await fetchMasterCopies()\n      const masterCopyAddress = await getMasterCopyAddressFromProxyAddress(safeAddress)\n      const masterCopy = masterCopies?.find((mc) => sameAddress(mc.address, masterCopyAddress))\n      setSafeInfo(masterCopy)\n    }\n\n    if (safeAddress) {\n      getMasterCopyInfo()\n    }\n  }, [safeAddress])\n\n  return (\n    <GnoForm onSubmit={handleSubmit}>\n      {() => (\n        <>\n          <Block className={classes.formContainer}>\n            <Heading tag=\"h2\">Contract Version</Heading>\n            <Row align=\"end\" grow>\n              <StyledLink rel=\"noreferrer noopener\" target=\"_blank\" href={safeInfo?.deployerRepoUrl}>\n                <Text size=\"xl\" as=\"span\" color=\"primary\">\n                  {getSafeVersion()}\n                  {getSafeVersionUpdate()}\n                </Text>\n                <StyledIcon size=\"sm\" type=\"externalLink\" color=\"primary\" />\n              </StyledLink>\n            </Row>\n            {safeNeedsUpdate && isUserOwner ? (\n              <Row align=\"end\" grow>\n                <Paragraph>\n                  <Button\n                    className={classes.saveBtn}\n                    color=\"primary\"\n                    onClick={handleUpdateSafe}\n                    size=\"small\"\n                    testId={SAFE_NAME_UPDATE_SAFE_BTN_TEST_ID}\n                    variant=\"contained\"\n                  >\n                    Update Safe\n                  </Button>\n                </Paragraph>\n              </Row>\n            ) : null}\n          </Block>\n          <Block className={classes.formContainer}>\n            <Heading tag=\"h2\">Modify Safe name</Heading>\n            <Paragraph>\n              You can change the name of this Safe. This name is only stored locally and never shared with Gnosis or any\n              third parties.\n            </Paragraph>\n            <Block className={classes.root}>\n              <Field\n                component={TextField}\n                defaultValue={safeName}\n                name=\"safeName\"\n                placeholder=\"Safe name*\"\n                testId={SAFE_NAME_INPUT_TEST_ID}\n                text=\"Safe name*\"\n                type=\"text\"\n                validate={composeValidators(required, validAddressBookName)}\n              />\n            </Block>\n          </Block>\n          <Row align=\"end\" className={classes.controlsRow} grow>\n            <Col end=\"xs\">\n              <Button\n                className={classes.saveBtn}\n                color=\"primary\"\n                size=\"small\"\n                testId={SAFE_NAME_SUBMIT_BTN_TEST_ID}\n                type=\"submit\"\n                variant=\"contained\"\n              >\n                Save\n              </Button>\n            </Col>\n          </Row>\n          <Modal description=\"Update Safe\" handleClose={toggleModal} open={isModalOpen} title=\"Update Safe\">\n            <UpdateSafeModal onClose={toggleModal} safeAddress={safeAddress} safeCurrentVersion={safeCurrentVersion} />\n          </Modal>\n        </>\n      )}\n    </GnoForm>\n  )\n}\n\nexport default SafeDetails\n"],"sourceRoot":""}